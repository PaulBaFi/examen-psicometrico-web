<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Punteado</title>

    <link rel="stylesheet" href="/styles/app.css" />
    <link rel="stylesheet" href="/styles/test-punteado.css" />
  </head>

  <body>
    <div class="test-puntado-content">
      <a href="/index.html" class="return-btn button">Regresar</a>

      <header class="header-test header-test-content">
        <h1 class="test-title">Test de puntado</h1>
        <button onclick="iniciarTest()" class="button">Iniciar</button>
      </header>

      <div class="test-background">
        <div id="contenedor">
          <div id="disco">
            <div
              id="orificio1"
              class="orificio"
              onclick="verificarAcierto(1, this)"
            ></div>
            <div
              id="orificio2"
              class="orificio"
              onclick="verificarAcierto(2, this)"
            ></div>
            <div
              id="orificio3"
              class="orificio"
              onclick="verificarAcierto(3, this)"
            ></div>

            <div id="estadistica1" class="estadistica"></div>
            <div id="estadistica2" class="estadistica"></div>
            <div id="estadistica3" class="estadistica"></div>
          </div>
          <div id="cuadro-central">
            <h2 id="aciertosTotales">0 ACIERTOS</h2>
            <p id="promedioAciertos">0.00 SEG. DE ACIERTO</p>
            <p id="errores">0 ERRORES</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let aciertosTotales = 0;
      let errores = 0;
      let secuenciaActual = 1;
      let testActivo = false;
      let tiemposPorOrificio = [0, 0, 0];
      let aciertosPorOrificio = [0, 0, 0];
      let tiempoInicio = Date.now();
      let tiempoLimite = 30000; // 30 segundos

      function iniciarTest() {
        aciertosTotales = 0;
        errores = 0;
        secuenciaActual = 1;
        testActivo = true;
        tiemposPorOrificio = [0, 0, 0];
        aciertosPorOrificio = [0, 0, 0];
        tiempoInicio = Date.now();
        document.getElementById("disco").style.animation =
          "spin 5s linear infinite";

        setTimeout(finalizarTest, tiempoLimite); // Detener despuÃ©s de 30s
      }

      function verificarAcierto(orificio, elemento) {
        if (!testActivo) return;

        if (orificio !== secuenciaActual) {
          errores++;
          actualizarPuntuacion();
          return;
        }

        const tiempoAcierto = (Date.now() - tiempoInicio) / 1000;
        tiemposPorOrificio[orificio - 1] += tiempoAcierto;
        aciertosPorOrificio[orificio - 1]++;
        aciertosTotales++;

        elemento.style.backgroundColor = "#FACA15";
        setTimeout(() => (elemento.style.backgroundColor = "white"), 500);

        secuenciaActual = secuenciaActual === 3 ? 1 : secuenciaActual + 1;
        actualizarPuntuacion();
      }

      function actualizarPuntuacion() {
        document.getElementById(
          "aciertosTotales"
        ).textContent = `${aciertosTotales} ACIERTOS`;
        document.getElementById("errores").textContent = `${errores} ERRORES`;
      }

      function finalizarTest() {
        testActivo = false;
        document.getElementById("disco").style.animation = "none";
        mostrarEstadisticasFinales();
      }

      function mostrarEstadisticasFinales() {
        for (let i = 0; i < 3; i++) {
          const promedio = (
            tiemposPorOrificio[i] / (aciertosPorOrificio[i] || 1)
          ).toFixed(2);
          document.getElementById(
            `estadistica${i + 1}`
          ).innerHTML = `${aciertosPorOrificio[i]} aciertos <br /> ${promedio} seg/acierto`;
        }

        const promedioTotal = (
          tiemposPorOrificio.reduce((a, b) => a + b) / (aciertosTotales || 1)
        ).toFixed(2);
        document.getElementById(
          "promedioAciertos"
        ).textContent = `${promedioTotal} SEG. DE ACIERTO`;
      }
    </script>
  </body>
</html>
